<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<p id="output"></p>
	<script type="text/javascript" src="assets.js"></script>
	<script type="text/javascript" src="main.js"></script>
	<script type="text/javascript" src="displayObject.js"></script>
	<script type="text/javascript" src="rectangle.js"></script>
	<script type="text/javascript" src="circle.js"></script>
	<script type="text/javascript" src="line.js"></script>
	<script type="text/javascript" src="text.js"></script>
	<script type="text/javascript" src="group.js"></script>
	<script type="text/javascript" src="sprite.js"></script>
	<script type="text/javascript" src="keyboard.js"></script>
	<script type="text/javascript" src="pointer.js"></script>
	<script type="text/javascript" src="button.js"></script>
	<script type="text/javascript">

		assets.load(["fonts/puzzler.otf", "images/button.json"]).then(() => setup());
		let canvas, stage, pointer, cat, tiger, hedgehog;
		let buttons = [];
		let draggableSprites = [];

		function setup() {
			canvas = makeCanvas(512, 512);
			stage = new DisplayObject();
			stage.width = canvas.width;
			stage.height = canvas.height;

			tiger = sprite(assets["up.png"]);
			stage.putCenter(tiger);
			tiger.draggable = true;

			cat = sprite(assets["down.png"]);
			stage.putCenter(cat, -32, -32);
			cat.draggable = true;

			hedgehog = sprite(assets["over.png"]);
			stage.putCenter(hedgehog, 32, 32);
			hedgehog.draggable = true;

			pointer = makePointer(canvas);
			gameLoop();
		}

		function gameLoop() {
			requestAnimationFrame(gameLoop);

			pointer.updateDragAndDrop(draggableSprites);

			if (buttons.length > 0) {
				canvas.style.cursor = "auto";

				buttons.forEach(button => {
					button.update(pointer, canvas);
					if (button.state === "over" || button.state === "down") {
						if(button.parent !== undefined) {
							canvas.style.cursor = "pointer";
						}
					}
				});
			}

			render(canvas);
		}



 	</script>
</body>
</html>