<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<script type="text/javascript" src="assets.js"></script>
	<script type="text/javascript" src="main.js"></script>
	<script type="text/javascript" src="displayObject.js"></script>
	<script type="text/javascript" src="rectangle.js"></script>
	<script type="text/javascript" src="circle.js"></script>
	<script type="text/javascript" src="line.js"></script>
	<script type="text/javascript" src="text.js"></script>
	<script type="text/javascript" src="group.js"></script>
	<script type="text/javascript" src="sprite.js"></script>
	<script type="text/javascript">
		let canvas = makeCanvas(512, 512);
		let stage = new DisplayObject();
		stage.width = canvas.width;
		stage.height = canvas.height;

		let ball = circle(32, "gray", "black", 2, 96, 120)
		ball.vx = randomInt(5, 15);
		ball.vy = randomInt(5, 15);
		ball.gravity = 0.3;
		ball.frictionX = 1;
		ball.frictionY = 0;
		ball.mass = 1.3;

		let fps = 30,
				previous = 0,
				frameDuration = 1000 / fps,
				lag = 0;

		gameLoop();

		function gameLoop(timestamp) {
			requestAnimationFrame(gameLoop);

			if (!timestamp) timestamp = 0;
			let elapsed = timestamp - previous;

			if (elapsed > 200) elapsed = frameDuration;

			lag += elapsed;
			
			while(lag >= frameDuration) {
				capturePreviousPositions(stage);

				update();

				lag -= frameDuration;
			}

			let lagOffset = lag / frameDuration;

			renderWithInterpolation(canvas, lagOffset);

			previous = timestamp;
 		}

 		function update() {

 			ball.vy += ball.gravity;
 			ball.vx *= ball.frictionX;
 			ball.x += ball.vx;
 			ball.y += ball.vy;

 			let collision = contain(ball, stage.localBounds, true);
 			if (collision === "bottom") {
 				ball.frictionX = 0.96;
 			} else {
 				ball.frictionX = 1;
 			}
 		}

 		function capturePreviousPositions(stage) {
 			stage.children.forEach(sprite => {
 				setPreviousPosition(sprite);
 			});

 			function setPreviousPosition(sprite) {
 				sprite.previousX = sprite.x;
 				sprite.previousY = sprite.y;

 				if (sprite.children && sprite.children.length > 0) {
 					sprite.children.forEach(child => {})
 					setPreviousPosition(child);
 				}
 			}
 		}

	</script>
</body>
</html>